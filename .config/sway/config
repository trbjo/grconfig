set $alt Mod1
set $super Mod4

include "~/.config/sway/`hostnamectl hostname`"

#
### Input
#

# Disable touch screen
input "1739:6572:SYNA2393:00_06CB:19AC" {
    events disabled
}

input type:keyboard {
    repeat_delay 200
    repeat_rate 60
    xkb_options compose:ralt
}

input type:pointer {
    pointer_accel 0.4
}

input "1:1:AT_Translated_Set_2_keyboard" {
    xkb_layout us(dvorak)
    xkb_options ctrl:swap_lalt_lctl_lwin,compose:ralt,caps:escape
}

input "1739:52552:SYNA1D31:00_06CB:CD48_Touchpad" {
    dwt enabled
    tap enabled
    natural_scroll enabled
    middle_emulation enabled
    pointer_accel 0.3
    accel_profile adaptive
    scroll_factor 1.1
}

input "1267:12602:ELAN0720:00_04F3:313A" {
    dwt enabled
    tap enabled
    natural_scroll enabled
    middle_emulation enabled
    pointer_accel 0.3
    accel_profile adaptive
    scroll_factor 1.1
}

seat seat0 xcursor_theme Adwaita 24
seat seat0 hide_cursor 15000
seat seat0 hide_cursor when-typing enable

# bindswitch --reload lid:on exec '! grep -q "enabled" /sys/class/drm/{card0-DP-1,card0-DP-2,card0-HDMI-A-1}/enabled && systemctl suspend || swaymsg output eDP-1 disable'
bindswitch --locked --reload lid:on output eDP-1 disable
bindswitch --locked --reload lid:off output eDP-1 enable

#
## Keybindings
#

bindsym $super+tab nop

bindsym ctrl+alt+F1 nop
bindsym ctrl+alt+F2 nop
bindsym ctrl+alt+F3 nop
bindsym ctrl+alt+F4 nop
bindsym ctrl+alt+F5 nop
bindsym ctrl+alt+F6 nop
bindsym ctrl+alt+F8 nop
bindsym ctrl+alt+F7 nop
bindsym ctrl+alt+F9 nop
bindsym ctrl+alt+F10 nop
bindsym ctrl+alt+F11 nop
bindsym ctrl+alt+F12 nop

# For the Plantronic headset
bindsym --locked XF86AudioPlay exec playerctl play-pause
bindsym --locked XF86AudioNext exec playerctl next
bindsym --locked XF86AudioPrev exec playerctl previous

# undoes the button completely
bindsym --locked XF86WLAN exec doas /usr/bin/rfkill unblock wifi

bindsym --no-repeat ctrl+space [title="^PopUp$"] scratchpad show, move position center, resize set width 100ppt height 100ppt, resize shrink up 1100px, resize grow up 337px

bindsym --no-repeat $alt+l output eDP-1 disable, output DP-1 enable
bindsym --no-repeat $alt+shift+l output eDP-1 enable


bindsym $alt+return exec /usr/bin/alacritty
bindsym --no-repeat $alt+space [app_id="^PopUp$"] focus, fullscreen enable

# kill focused window
bindsym --no-repeat $alt+apostrophe kill

# kill with middle mouse click
bindsym button2 kill

# toggle focus
bindsym --no-repeat ctrl+shift+space focus mode_toggle

# Toggle the current focus between tiling and floating mode
bindsym --no-repeat $alt+shift+space floating toggle

floating_modifier ctrl normal

# Switch the current container between different layout styles
bindsym --no-repeat $alt+shift+e layout toggle tabbed split

#
# Moving around:
#

# Move your focus around

bindsym $alt+t focus down
bindsym $alt+c focus up
bindsym $alt+h focus left
bindsym $alt+n focus right

bindsym $alt+shift+t move down
bindsym $alt+shift+c move up
bindsym $alt+shift+h move left
bindsym $alt+shift+n move right

bindsym --no-repeat $alt+f fullscreen toggle
bindsym --no-repeat $alt+v splith
bindsym --no-repeat $alt+w splitv

bindsym ctrl+$alt+h resize shrink width 80px
bindsym ctrl+$alt+c resize grow height 80px
bindsym ctrl+$alt+t resize shrink height 80px
bindsym ctrl+$alt+n resize grow width 80px

bindsym --locked XF86AudioMute exec playerctl pause
bindsym --locked XF86MonBrightnessDown exec light -U 0.5 && light -S $(echo "$(light -G) /1.3" | bc -l)
bindsym --locked XF86MonBrightnessUp exec light -S $(echo "$(light -G) * 1.3" | bc -l) && light -A 0.5

# bindsym XF86AudioLowerVolume exec \
    # pactl set-sink-volume @DEFAULT_SINK@ -5%

# bindsym XF86AudioRaiseVolume exec \
    # pactl set-sink-volume @DEFAULT_SINK@ +5%

bindsym XF86AudioLowerVolume exec \
    amixer set Master 3%-

bindsym XF86AudioRaiseVolume exec \
    amixer set Master 3%+

bindsym --locked $alt+F4 exec [ -S /tmp/mpvsocket ] && echo 'cycle pause' | socat - /tmp/mpvsocket > /dev/null 2>&1 || /usr/bin/ssh music@Intel-NUC "tmux send-keys -t main:1.1 ' '"

bindsym --no-repeat ctrl+f10 exec xdg-open --mpv $(wl-paste)
bindsym --no-repeat ctrl+XF86Tools exec xdg-open --mpv $(wl-paste)

# open most recent download
# bindsym --no-repeat $alt+d exec xdg-open "$(ls -ctgd $HOME/dl/* | awk '$1=="-rw-r--r--" { $1=$2=$3=$4=$5=$6=$7=""; gsub("^[ \t]*","",$0); print $0; exit}')"
bindsym --no-repeat $alt+d exec xdg-open "$(ls -ctd1 $HOME/dl/* | head -1)"

bindsym $alt+y [app_id=^firefox$] focus; exec 'set -o noglob ; clipboard=$(wl-paste -n); grep "^https\\?://.\+\.\w\{2,3\}" <<< $clipboard && /usr/bin/firefox --new-tab "$clipboard" || /usr/bin/firefox --new-tab "https://duckduckgo.com/?t=ffab&q=${clipboard}"'
bindsym $alt+i [app_id=^firefox$] focus; exec 'set -o noglob ; clipboard=$(wl-paste --primary -n); grep "^https\\?://.\+\.\w\{2,3\}" <<< $clipboard && /usr/bin/firefox --new-tab "$clipboard" || /usr/bin/firefox --new-tab "https://duckduckgo.com/?t=ffab&q=${clipboard}"'
bindsym $alt+s fullscreen disable; exec bemenu-apps
bindsym $alt+p fullscreen disable; exec bemenu-pw
bindsym $alt+b fullscreen disable; exec clipman pick --tool wofi -T'--prompt=Clipboard --height=30% --width=30% --columns=5 -i -I --xoffset=660 --yoffset=-2'

bindsym $alt+o exec quicknotes.py
bindsym $alt+e [app_id=^sublime_text$] focus, exec /opt/sublime_text/sublime_text $HOME/quicknotes.md

bindsym --no-repeat Print exec 'pgrep slurp || (curdate=$(date +"Screenshot_%Y-%m-%d_%H:%M:%S.png"); grim $HOME/screenshots/$curdate && notify-send.sh "Screenshot taken" "$curdate" --icon=camera-photo --default-action="xdg-open $HOME/screenshots/$curdate" && wl-copy < "$HOME/screenshots/$curdate")'
bindsym --no-repeat $alt+Print exec 'pgrep slurp || (curdate=$(date +"Screenshot_%Y-%m-%d_%H:%M:%S.png"); swaymsg -t get_tree | jq -r ".. | select(.pid? and .visible?) | .rect | \\"\\\(.x),\\\(.y) \\\(.width)x\\\(.height)\\"" | env XCURSOR_SIZE=48 slurp -w 1 -c A5BAD1 -s C3DFFE94 | grim -g - $HOME/screenshots/$curdate && notify-send.sh "Screenshot taken" "$curdate" --icon=camera-photo --default-action="xdg-open $HOME/screenshots/$curdate" && wl-copy < $HOME/screenshots/$curdate)'


#
## Appearance
#

font pango:SF Pro Display Medium 10

default_border pixel 2
gaps inner 0
smart_gaps on
default_floating_border pixel 4
hide_edge_borders --i3 smart_no_gaps

titlebar_border_thickness 1
titlebar_padding 15 5
title_align center

floating_maximum_size 2050 x 1154
floating_minimum_size 10 x 10

set $WHITE #FFFFFF
set $BLACK #000000

client.focused           $WHITE  $WHITE   #404040   #5294e2  #5294e2
client.focused_inactive  $WHITE  $WHITE   #404040   #E6E6E6  #E6E6E6
client.unfocused         #c8c8c8  #D8D8D8   #506070   #E6E6E6  #E6E6E6

set $FGINACTIVE #908880

bar {
    id one
    position top
    font SF Pro Display Medium 11
    pango_markup enabled
    status_command i3blocks
    mode hide
    workspace_min_width 50
    height 22
    modifier $alt
    status_edge_padding 6
    separator_symbol " "
    strip_workspace_numbers yes
    colors {
        statusline $WHITE
        background $BLACK
        binding_mode $BLACK $BLACK #3584E4
        focused_workspace $BLACK $BLACK $WHITE
        active_workspace $BLACK $BLACK $WHITE
        inactive_workspace $BLACK $BLACK $FGINACTIVE
        }
}

#
## Window rules
#

assign [app_id="^(mpv|imv|org.pwmt.zathura|evince)$"] $ws5

# all new windows except the PopUp should receive focus.
for_window [title=^(?!(PopUp)$).*$] focus
for_window [app_id="^Chromium$" title="^teams.microsoft.com is sharing your screen.$"] border pixel 0
for_window [app_id="^\/usr\/bin\/chromium-snapshot-bin$" title="^Discord$"] title_format "Discord"

for_window [app_id="^(subl|sublime_text)$" title="^(Open File|Save File|)$"] fullscreen disable
for_window [app_id="^(subl|sublime_text)$" title="^Changelog - Sublime Tex$"] fullscreen disable, floating enable
for_window [title="^(Switch Project - Sublime Text|Select Application)$"] fullscreen disable, floating enable, move up 283px, resize set 580 388, border pixel 2

for_window [app_id="^gcr-prompter$"] fullscreen disable, floating enable
# for_window [title="(?!(Telegram)$)" app_id="^appimagekit_.*-Telegram_Desktop$"] floating enable, resize set 636 916

for_window [app_id="^PopUp$"] floating enable, border pixel 0, move scratchpad
for_window [app_id="^pavucontrol$"] floating enable, move position center, resize set width 100ppt height 100ppt, resize shrink down 1100px, resize set 727 0, resize grow down 500px

for_window [app_id="^firefox$" title="^Library$"] floating enable, border pixel 1, move position center, resize set width 100ppt height 100ppt, resize shrink down 450px, resize set width 1000, move down 35px

for_window [title="^Firefox — Sharing Indicator$"] floating enable, border pixel 0, sticky enable, resize set 57 30, move position 0 0

for_window [title="^(Save File|python3|Open File|Select Folder|Choose Files|Choose an image|Preferences - Sublime Merge)$"] floating enable, resize set 1000 800
for_window [app_id="^python3$"] floating enable, resize set 1000 800
for_window [app_id="^signal-desktop$" title=""] floating enable, resize set 1000 800

# custom logos.
for_window [app_id="^(org.pwmt.zathura)$"] layout tabbed, title_format "<span weight='100' foreground='#d73a49'></span>  %title"
for_window [app_id="^imv$"] title_format "<span weight='100' foreground='#3874C7'></span>  %title"
for_window [app_id="^mpv$"] title_format "<span weight='100' foreground='#FF0000'></span>  %title"
for_window [app_id="^Google-chrome-unstable$" title="^Microsoft Teams$"] title_format "<span weight='100' foreground='#6264A7'></span>  Microsoft Teams"
for_window [app_id="-Telegram_Desktop$" title="^Telegram$"] title_format "<span weight='100' foreground='#2FA5D8'></span>  %title"
for_window [app_id="Signal$" title="^Signal$"] title_format "<span weight='100' foreground='#3A76F0'></span>  %title"
for_window [app_id="firefox$" title="^Picture-in-Picture$"] floating enable, sticky enable, resize set 300 170, move position 2 28


exec "python ~/.local/bin/inactive-windows-transparency.py"
exec "dbus-update-activation-environment --systemd --all"
exec "systemctl --user import-environment"
exec /usr/bin/mako
exec /usr/bin/sh -c 'while pgrep sway > /dev/null 2>&1; do env PopUp=True /usr/bin/alacritty --class PopUp --title PopUp --command /usr/bin/zsh > /dev/null 2>&1; done'
exec "/usr/bin/clipman restore"
exec '/usr/bin/wl-paste --type text --watch sh -c "if [[ -f /tmp/clipman_ignore ]]; then rm /tmp/clipman_ignore; else /usr/bin/clipman store --max-items=2000; fi"'
exec /usr/bin/swayidle \
    timeout 30 'pgrep swaylockd && swaymsg "output * dpms off" && grep -q 0 /sys/class/power_supply/AC0/online && [ ! -f /tmp/inhibitSuspend ] && /usr/bin/systemctl suspend' \
    resume 'swaymsg "output * dpms on"' \
    timeout 120 'light -O && grep -q 0 /sys/class/power_supply/AC0/online && [ ! -f /tmp/inhibitScreen ] && light -T 0.2' \
    resume 'light -I; swaymsg "output * dpms on"' \
    timeout 150 'grep -q 0 /sys/class/power_supply/AC0/online && [ ! -f /tmp/inhibitScreen ] && loginctl lock-session && light -S 0' \
    resume "if [[ \$(ps -o etimes= -p \$(pgrep --oldest swaylockd)) -lt 300 ]]; then pkill -9 swaylockd; fi" \
    timeout 152 'grep -q 0 /sys/class/power_supply/AC0/online && [ ! -f /tmp/inhibitScreen ] && swaymsg "output * dpms off"' \
    timeout 180 'grep -q 0 /sys/class/power_supply/AC0/online && [ ! -f /tmp/inhibitSuspend ] && /usr/bin/systemctl suspend' \
    timeout 240 '[ -f /tmp/inhibitSuspend ] || grep -q "ens1u\|4c:1b:86:91:63:70\|54:64:d9:7e:dd:d3\|00:1e:80:8b:eb:fa" /proc/net/arp || loginctl lock-session' \
    timeout 360 '[ ! -f /tmp/inhibitScreen ] && loginctl lock-session && light -S 0' \
    timeout 362 'swaymsg "output * dpms off"'\
    before-sleep "! grep -q "enabled" /sys/class/drm/{card0-DP-1,card0-DP-2,card0-HDMI-A-1}/enabled && swaymsg output eDP-1 enable ; loginctl lock-session"\
    after-resume "swaymsg 'output * enable, output * dpms on'"\
    lock 'playerctl pause; if ! pgrep -x swaylockd > /dev/null 2>&1; then swaymsg bar one workspace_buttons no, bar one mode overlay; swaylockd; loginctl unlock-session; fi' \
    unlock 'swaymsg bar one mode hide, bar one workspace_buttons yes'

    # after-resume "if [[ \$(ps -o etimes= -p \$(pgrep --oldest swaylockd)) -lt 300 ]]; then pkill -9 swaylockd; fi; swaymsg 'output * enable, output * dpms on'"\
